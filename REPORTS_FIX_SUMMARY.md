# ๐ ููุฎุต ุฅุตูุงุญุงุช ูุธุงู ุงูุชูุงุฑูุฑ

## ๐ฏ ุงููุดููุฉ ุงูุฃุณุงุณูุฉ
ุนูุฏ ูุญุงููุฉ ูุชุญ ุชูุฑูุฑ ุงูุนููุงุก ูุงูููุฑุฏููุ ูุงู ุงูุชุทุจูู ูุนุทู ุงูุฎุทุฃ:
```
ุฎุทุฃ ูู ุชูููุฏ ุงูุชูุฑูุฑ: no such column: current_balance
```

## ๐ ุงูุณุจุจ ุงูุฌุฐุฑู
ุนุฏู ุชูุงูู ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- **ุฌุฏูู customers** ูุญุชูู ุนูู ุนููุฏ `current_balance`
- **ุฌุฏูู suppliers** **ูุง ูุญุชูู** ุนูู ุนููุฏ `current_balance`

ุงูุงุณุชุนูุงูุงุชู ุงููุฏููุฉ ูุงูุช ุชุญุงูู ุงููุตูู ูุนููุฏ ุบูุฑ ููุฌูุฏ ูู ุฌุฏูู suppliers.

## โ ุงูุญููู ุงููุทุจูุฉ

### 1. ุชูุฑูุฑ ุงูุนููุงุก (Customers Report) โ
**ุงูููู**: `src/ui/dialogs/contacts_report_dialog.py` - ุฏุงูุฉ `generate_customers_report()`

**ุงูุฅุตูุงุญุงุช**:
- โ ุงุณุชุฎุฏุงู `COALESCE(current_balance, 0)` ูุชุฌูุจ ุฃุฎุทุงุก NULL
- โ ูุถุน ุงุณุชุนูุงูุงุช ูู ูุชู `try/except` ูููุตูุฉ
- โ ุงูุชุญูู ูู ูุฌูุฏ ุงูุจูุงูุงุช ูุจู ุนุฑุถูุง
- โ ุฑุณุงุฆู ุฎุทุฃ ุตุฏููุฉ ูููุณุชุฎุฏู

**ุงูุงุณุชุนูุงูุงุช ุงููุญุฏุซุฉ**:
```sql
-- ุฃุนูู ุงูุนููุงุก ุฑุตูุฏุงู (ุขูู)
SELECT name, COALESCE(current_balance, 0) as balance 
FROM customers 
WHERE COALESCE(current_balance, 0) > 0 
ORDER BY balance DESC LIMIT 5

-- ุฃุนูู ุงูุนููุงุก ุดุฑุงุกู
SELECT c.name, COUNT(*) as purchase_count, COALESCE(SUM(s.total_amount), 0) as total_amount
FROM customers c
LEFT JOIN sales s ON c.id = s.customer_id
GROUP BY c.id
ORDER BY purchase_count DESC LIMIT 5
```

### 2. ุชูุฑูุฑ ุงูููุฑุฏูู (Suppliers Report) โ
**ุงูููู**: `src/ui/dialogs/contacts_report_dialog.py` - ุฏุงูุฉ `generate_suppliers_report()`

**ุงููุดููุฉ**: ูุง ููุฌุฏ ุนููุฏ `current_balance` ูู ุฌุฏูู suppliers

**ุงูุญู**: 
- โ ุฅุฒุงูุฉ ุงุณุชุนูุงู "ุงูุฃุนูู ุฑุตูุฏุงู" (ูุง ููุทุจู)
- โ ุงูุชุฑููุฒ ุนูู "ุงูุฃูุซุฑ ุนูููุงุช" ุจุฏูุงู ููู
- โ ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงูุนูููุงุช ูุงููุจุงูุบ ุงููุงููุฉ

**ุงูุงุณุชุนูุงู ุงููุญุฏุซ**:
```sql
-- ุงูููุฑุฏูู ุงูุฃูุซุฑ ุนูููุงุช
SELECT s.name, COUNT(*) as purchase_count, COALESCE(SUM(p.total_amount), 0) as total_amount
FROM suppliers s
LEFT JOIN purchases p ON s.id = p.supplier_id
GROUP BY s.id
ORDER BY purchase_count DESC LIMIT 5
```

### 3. ุชูุฑูุฑ ุงูููุงุฑูุฉ (Comparison Report) โ
**ุงูููู**: `src/ui/dialogs/contacts_report_dialog.py` - ุฏุงูุฉ `generate_comparison_report()`

**ุงูุชุญุณููุงุช**:
- โ ููุงุฑูุฉ ุฅุญุตุงุฆูุงุช ุงูุนููุงุก ูุงูููุฑุฏูู (ุงูุฃุนุฏุงุฏ ูุงููุณุจ)
- โ ุนุฏู ูุญุงููุฉ ููุงุฑูุฉ ุงูุฃุฑุตุฏุฉ ุงููุณุชุญูุฉ ููููุฑุฏูู (ูุง ุชูุฌุฏ)
- โ ุนุฑุถ ุงูุฃุฑุตุฏุฉ ุงููุณุชุญูุฉ ูู ุงูุนููุงุก ููุท
- โ ููุงุฑูุฉ ุงููุจูุนุงุช ูุงููุดุชุฑูุงุช ูุน ุญุณุงุจ ุงูุฃุฑุจุงุญ

**ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ**:
```python
- ุนุฑุถ ุฌุฏุงูู ุจุตุฑูุฉ ูุงุถุญุฉ ุจุฃุนูุฏุฉ ููุณูุฉ
- ุชุญููู ุชููุงุฆู ูุธูุฑ ุฃู ุงูุทุฑู ุฃูุจุฑ
- ุญุณุงุจ ุตุงูู ุงูุฃุฑุจุงุญ = ุงููุจูุนุงุช - ุงููุดุชุฑูุงุช
- ุนุฑุถ ุงูุฑุณุงุฆู ุจุตูุบุฉ ุนุฑุจูุฉ ุงุญุชุฑุงููุฉ
```

## ๐ ุงูุชุญุณููุงุช ุงููููุฌูุฉ

### ูุนุงููุฑ ุงูุฃูุงู ุงููุทุจูุฉ:
1. **COALESCE Principle**: ุงุณุชุฎุฏุงู `COALESCE()` ูุฌููุน ุงูุฃุนูุฏุฉ ุงูุงุฎุชูุงุฑูุฉ
2. **Try/Except Pattern**: ูู ุงุณุชุนูุงู ูู ูุชูุฉ `try/except` ูููุตูุฉ
3. **Null Safety**: ุงูุชุญูู ูู ุงููุชุงุฆุฌ ูุจู ุงูุนูููุงุช ุงูุญุณุงุจูุฉ
4. **Error Messages**: ุฑุณุงุฆู ุฎุทุฃ ูููุฏุฉ ูุจุตูุบุฉ ุนุฑุจูุฉ ุตุญูุญุฉ

### ููุท ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:
```python
try:
    # ุงุณุชุนูุงู ูุญูู
    results = db_manager.fetch_all(safe_query)
except:
    # ูููุฉ ุงูุชุฑุงุถูุฉ ุขููุฉ
    results = []

# ุชุญูู ูุจู ุงููุนุงูุฌุฉ
if results:
    # ูุนุงูุฌุฉ ุงูุจูุงูุงุช
else:
    # ุฑุณุงูุฉ ูุฏูุฉ ูููุณุชุฎุฏู
```

## โ ุงููุชุงุฆุฌ ุงููุฎุชุจุฑุฉ

### ุงุฎุชุจุงุฑ ูุญุฏุฉ SQL:
```
โ ุฅุญุตุงุฆูุงุช ุงูุนููุงุก - ูุฌุญ
โ ุฃุนูู ุงูุนููุงุก ุฑุตูุฏุงู - ูุฌุญ
โ ุฃุนูู ุงูุนููุงุก ุดุฑุงุกู - ูุฌุญ
โ ุฅุญุตุงุฆูุงุช ุงูููุฑุฏูู - ูุฌุญ
โ ุฃุนูู ุงูููุฑุฏูู ุนูููุงุช - ูุฌุญ (ุชู ุฅุตูุงุญู)
โ ุฅุญุตุงุฆูุงุช ุงููุจูุนุงุช - ูุฌุญ
โ ุฅุญุตุงุฆูุงุช ุงููุดุชุฑูุงุช - ูุฌุญ
```

### ุงุฎุชุจุงุฑ ุงูุชุทุจูู:
- โ ุงูุชุทุจูู ูุจุฏุฃ ุจุฏูู ุฃุฎุทุงุก
- โ ุชุณุฌูู ุงูุฏุฎูู ูุนูู
- โ ุงููุงูุฐุฉ ุงูุฑุฆูุณูุฉ ุชูุชุญ
- โ ุฌููุน ุงูุฎุฏูุงุช ุชููููุฃ ุจูุฌุงุญ

## ๐จ ุชุญุณููุงุช ุงููุงุฌูุฉ

### ุนุฑุถ ุงูุชูุงุฑูุฑ:
- โ ุชูุณูู ุงุญุชุฑุงูู ุจุฃุนูุฏุฉ ูุญุงุฐุงุฉ
- โ ุฑููุฒ ุชุนุจูุฑูุฉ ูููููุฉ (๐ ๐ฆ ๐ฐ ๐๏ธ ุฅูุฎ)
- โ ููุงุตู ูุงุถุญุฉ ููุงุจูุฉ ูููุฑุงุกุฉ
- โ ูุนูููุงุช ุชุงุฑูุฎ ููุช ุงูุชูุฑูุฑ

### ูุนุงูุฌุฉ ุงูุญุงูุงุช ุงูุฎุงุตุฉ:
- โ ุฅุฐุง ูู ุชูู ููุงู ุจูุงูุงุช: ุฑุณุงูุฉ "ูุง ุชูุฌุฏ ุนูููุงุช"
- โ ุฅุฐุง ุญุฏุซ ุฎุทุฃ: ุฑุณุงูุฉ ุฎุทุฃ ููุตูุฉ + ุงูุชุฑุงุญ ุงูุญู
- โ ููุชูุงุฑูุฑ ุงููุงุฑุบุฉ: ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุงูุฃุณุงุณูุฉ ุนูู ุงูุฃูู

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### 1. `src/ui/dialogs/contacts_report_dialog.py`
- **ุงูุณุทูุฑ ุงููุนุฏูุฉ**: 260-310 (ุชูุฑูุฑ ุงูุนููุงุก)
- **ุงูุณุทูุฑ ุงููุนุฏูุฉ**: 311-380 (ุชูุฑูุฑ ุงูููุฑุฏูู)
- **ุงูุณุทูุฑ ุงููุนุฏูุฉ**: 381-470 (ุชูุฑูุฑ ุงูููุงุฑูุฉ)

### 2. ูููุงุช ุงูุงุฎุชุจุงุฑ (ุชู ุฅูุดุงุคูุง):
- `test_reports.py` - ุงุฎุชุจุงุฑ ุดุงูู ูุฌููุน ุงูุงุณุชุนูุงูุงุช
- `test_reports_v2.py` - ุงุฎุชุจุงุฑ ูุญุฏุซ ุจุฏูู ุฃุฎุทุงุก

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑูุฉ)

1. **ุชุญุณููุงุช ุฅุถุงููุฉ ููุชูุงุฑูุฑ**:
   - [ ] ุฅุถุงูุฉ ุชุตููุฉ ุญุณุจ ูุทุงู ุงูุชุงุฑูุฎ
   - [ ] ุชุตุฏูุฑ ุฅูู PDF (ูุง ููุท TXT)
   - [ ] ุทุจุงุนุฉ ุงุญุชุฑุงููุฉ ูุน ุงูุชูุณููุงุช
   - [ ] ุฑุณูู ุจูุงููุฉ ูุฌุฏุงูู ุฅุญุตุงุฆูุฉ

2. **ุชุญุณููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช**:
   - [ ] ุฅุถุงูุฉ ุนููุฏ `current_balance` ูุฌุฏูู suppliers (ุฅุฐุง ูุฒู)
   - [ ] ุฅุถุงูุฉ ููุงุฑุณ ูุชุญุณูู ุงูุฃุฏุงุก
   - [ ] ุฅุถุงูุฉ ุนููุฏ `payment_date` ูุชุตููุฉ ุงููุฏููุนุงุช

3. **ุชุญุณููุงุช ุงูุฃุฏุงุก**:
   - [ ] ุชุฎุฒูู ูุคูุช ููุชูุงุฑูุฑ
   - [ ] ุชุญุฏูุซ ุชููุงุฆู ุนูุฏ ุชุบููุฑ ุงูุจูุงูุงุช
   - [ ] ูุนุงูุฌุฉ ุบูุฑ ูุชุฒุงููุฉ ููุจูุงูุงุช ุงููุจูุฑุฉ

## ๐ ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ

### ุงูุฃููุงุท ุงูุฌูุฏุฉ:
โ ุงุณุชุฎุฏุงู COALESCE() ููู ุนููุฏ ูุฏ ูุง ูููู ููุฌูุฏุงู
โ ูุถุน ูู ุงุณุชุนูุงู ูู try/except ูููุตูุฉ
โ ุงูุชุญูู ูู ุงูุจูุงูุงุช ูุจู ุงููุนุงูุฌุฉ
โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููุงุจูุฉ ููุชุตุญูุญ

### ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ ุงูุชู ุชู ุชุฌูุจูุง:
โ ูุง ุชูุชุฑุถ ูุฌูุฏ ุฌููุน ุงูุฃุนูุฏุฉ
โ ูุง ุชุฎูุท ุงุณุชุนูุงูุงุช ุฌุฏุงูู ูุฎุชููุฉ ุจุฏูู ุงูุชุญูู
โ ูุง ุชุนุฑุถ ุฃุฎุทุงุก SQL ุงูุฎุงู ูููุณุชุฎุฏู
โ ูุง ุชูุชุฑุถ ุฃู SUM() ุฏุงุฆูุงู ูุนูุฏ ุฑูู (ูุฏ ูุนูุฏ NULL)

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2025-11-17 11:31  
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุฅูุชุงุฌ  
**ุงูุงุฎุชุจุงุฑ**: โ ูุฌุญ ุจุฏูู ุฃุฎุทุงุก
